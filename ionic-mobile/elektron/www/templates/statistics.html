<ion-view view-title="Estadisticas">

    <ion-content >
      <div class="item">
        <div class="button-bar">
          <a class="button button-positive" ng-show="listado == true">Listado</a>
          <a class="button" ng-show="listado == false" ng-click="changeToList()">Listado</a>
          <a class="button" ng-show="listado == true" ng-click="changeToCharts()">Graficos</a>
          <a class="button button-positive" ng-show="listado == false">Graficos</a>
        </div>
      </div>

      <div ng-show="listado == true" class="card" ng-repeat="component in components_server">
        <div class="item item-divider">
            <b>Componente:</b> {{component.device.label}}
            <span ng-if="component.device.devicestate.name == 'on'" class="badge-component badge badge-balanced">encendido</span>
            <span ng-if="component.device.devicestate.name == 'off'" class="badge-component badge badge-assertive">apagado</span>
        </div>
        <div class="list">
            <div class="item">
              <div class="row">
                <div class="col">
                  <span>Consumo: <b>{{component.data_sum * 1.0 | number:0}}kw</b></span>
                </div>
                <div class="col">

                </div>
                <div class="col">
                  <span class="">Costo: <b>$ {{component.data_sum * 1.5 | number:0}}</b></span>
                </div>
                <div class="col">
                  <span class="">Co2: <b>32 Kg</b></span>
                </div>
              </div>
            </div>
            <div class="item">
              <div class="row">
                  <span>Última medición: <b> {{ 1288323623006 | date:'yyyy-MM-dd HH:mm' }}</b></span>
                  <span class="badge badge-energized"><b> {{ component.last_data || 0 }}</b></span>
              </div>
            </div>
            <div class="item">
              <div class="row">
                  <span>Último período: <b> {{ 1288323623006 | date:'yyyy-MM-dd HH:mm' }}</b></span>
                  <span class="badge badge-light"><b>{{ component.last_data || 0 }}</b></span>
              </div>
            </div>
            <div class="item">
              <div class="row">
                <div class="col">
                  <span>Encendidos: <b>{{component.device.state_counter_on}}</b></span>
                </div>
                <div class="col">

                </div>
                <div class="col">
                  <span>Apagados: <b>{{component.device.state_counter_off}}</b></span>
                </div>
              </div>
            </div>
        </div>
      </div>

      <div ng-show="listado == false">
        <div class="card">
          <div class="item item-divider">
              <b>Porcentaje de consumo de componentes</b>
          </div>
          <div class="item">
            <canvas id="doughnut" height="150" class="chart chart-doughnut"
              chart-data="doughnutdata" chart-labels="doughnutlabels">
            </canvas>
          </div>
          <div class="item">
              <div ng-repeat="value in doughnut.config.data.labels">
                {{ value }}
                <!--<span class="badge" style="background-color:{{doughnut.config.data.datasets[0].backgroundColor[$index]}};">
                  {{ value }}
                </span>-->
              </div>
          </div>
        </div>

        <div class="card">
          <div class="item item-divider">
              <b>Gafico comparativo de componentes</b>
          </div>
          <div class="item">

            <label class="item item-input item-select">
              <div class="input-label">
                Componente 1
              </div>
              <select ng-model="barOptions.componentLeft" ng-change="changeLeftBarComponent()">
                <option ng-repeat="component in components_totales" value="{{component.id}}">{{component.label}}</option>
              </select>

            </label>

            <label class="item item-input item-select">
              <div class="input-label">
                Componente 2
              </div>
              <select ng-model="barOptions.componentRight" ng-change="changeRightBarComponent()">
                <option ng-repeat="component in components_totales" value="{{component.id}}">{{component.label}}</option>
              </select>
            </label>

            <label class="item item-input item-select">
              <div class="input-label">
                Precisión
              </div>
              <select ng-model="barOptions.precisionSelected" ng-change="changeCriteria()">
                <option ng-repeat="prec in barPrecision" value="{{prec.url}}" >{{prec.label}}</option>
              </select>
            </label>
            <div class="item">
              <a ng-click="changeBarComponents()" class="button icon-right ion-chevron-right button-calm">Ver gráfico</a>
            </div>
            <div class="item">
                {{barOptions.precisionSelected}}
                {{barOptions.componentRight}}
                {{barOptions.componentLeft}}
            </div>

          </div>
          <div class="item">
            <canvas id="bar" class="chart chart-bar"
              chart-data="bardata" chart-labels="barlabels" chart-series="barseries">
            </canvas>
          </div>
        </div>

      </div>


    </ion-content>
</ion-view>
