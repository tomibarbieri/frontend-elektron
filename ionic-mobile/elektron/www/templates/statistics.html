<ion-view view-title="Estadisticas">
    <ion-content >
      <div class="item">
        <div class="button-bar">
          <a class="button button-positive" ng-show="listado == true">Listado</a>
          <a class="button" ng-show="listado == false" ng-click="changeToList()">Listado</a>
          <a class="button" ng-show="listado == true" ng-click="changeToCharts()">Graficos</a>
          <a class="button button-positive" ng-show="listado == false">Graficos</a>
        </div>
      </div>
      <div ng-show="listado == true" class="card" ng-repeat="component in components_statistics">
        <div class="item item-divider">
            <b>Componente:</b> {{component.device.label}}
            <span ng-if="component.device.devicestate.name == 'on'" class="badge-component badge badge-balanced">encendido</span>
            <span ng-if="component.device.devicestate.name == 'off'" class="badge-component badge badge-assertive">apagado</span>
        </div>
        <div class="list">
            <div class="item">
              <div class="row">
                <div class="col">
                  <span>Consumo: <b>{{component.data_sum | number:1 }} W ({{ component.device_percent || 0 | number:1 }}% del total)</b></span>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <span class="">Costo: <b>$ {{component.total_tarifa | number:1}}</b></span>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <span class="">Co2: <b>{{ component.total_co2 | number:1 }} Kg</b></span>
                </div>
              </div>
            </div>
            <div class="item">
              <div class="row">
                  <span>Última medición: <b> {{ component.last_data.date | date:'dd/MM/yyyy HH:mm' }}</b></span>
                  <span class="badge badge-energized"><b> {{ component.last_data.value || 0 }}</b></span>
              </div>
            </div>
            <div class="item">
              <div class="row">
                  <span class="elipsis">Último período:<br><b>desde</b> {{ component.state_period_from | date:'dd/MM/yyyy HH:mm' }}<br><b>hasta</b> {{ component.state_period_to | date:'dd/MM/yyyy HH:mm' }}.</span>
                  <span class="badge badge-light"><b>{{ component.data_list_sum_states || 0 }}</b></span>
              </div>
            </div>
            <div class="item">
              <div class="row">
                <div class="col">
                  <span>Encendidos: <b>{{component.device.state_counter_on}}</b></span>
                </div>
                <div class="col">
                </div>
                <div class="col">
                  <span>Apagados: <b>{{component.device.state_counter_off}}</b></span>
                </div>
              </div>
            </div>
        </div>
      </div>
      <div ng-show="listado == false">
        <div class="card">
          <div class="item item-divider">
              <b>Porcentaje de consumo de componentes</b>
          </div>
          <div class="item">
            <canvas id="doughnut" height="150" class="chart chart-doughnut"
              chart-data="doughnutdata" chart-labels="doughnutlabels">
            </canvas>
          </div>
          <div class="item">
            <div class="row">
              <div class="col">

              </div>
              <div class="col">
                <div ng-repeat="value in doughnut.config.data.labels" style="text-align:center; font-size:0.7em; border-radius: 25px;background-color:{{doughnut.config.data.datasets[0].backgroundColor[$index]}};">
                  <span>{{ value }}</span>
                </div>
              </div>
              <div class="col">

              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="item item-divider">
              <b>Gafico comparativo de componentes</b>
          </div>
          <div class="item">
            <label class="item item-input item-select">
              <div class="input-label">
                Componente 1
              </div>
              <select ng-model="barOptions.componentLeft" >
                <option ng-repeat="component in components_server" value="{{component.id}}">{{component.label}}</option>
              </select>
            </label>
            <label class="item item-input item-select">
              <div class="input-label">
                Componente 2
              </div>
              <select ng-model="barOptions.componentRight" >
                <option ng-repeat="component in components_server" value="{{component.id}}">{{component.label}}</option>
              </select>
            </label>

            <label class="item item-input item-select">
              <div class="input-label">
                Precisión
              </div>
              <select ng-model="barOptions.precisionSelected" >
                <option ng-repeat="prec in barPrecision" value="{{prec.url}}" >{{prec.label}}</option>
              </select>
            </label>
            <div class="item">
              <a ng-click="createBarChart()" class="button icon-right ion-chevron-right button-calm">Ver gráfico</a>
            </div>
          </div>
          <div class="item">
            <canvas id="bar" class="chart chart-bar"
              chart-data="bardata" chart-labels="barlabels" chart-series="barseries">
            </canvas>
          </div>
        </div>
      </div>
    </ion-content>
</ion-view>
