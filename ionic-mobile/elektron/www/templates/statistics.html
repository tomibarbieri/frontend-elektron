<ion-view view-title="Estadisticas">
    <ion-content >
      <div class="item">
        <div class="button-bar">
          <a class="button button-positive" ng-show="listado == true">Listado</a>
          <a class="button" ng-show="listado == false" ng-click="changeToList()">Listado</a>
          <a class="button" ng-show="listado == true" ng-click="changeToCharts()">Graficos</a>
          <a class="button button-positive" ng-show="listado == false">Graficos</a>
        </div>
      </div>

      <div ng-show="spinner == true" class="center-spinner">

        <ion-spinner icon="android"></ion-spinner>

      </div>

      <div ng-show="listado == true" class="card" ng-repeat="component in components_statistics">

        <div class="item item-divider">
            <b>Componente:</b> {{component.device.label}}
            <span ng-if="component.device.devicestate.name == 'on'" class="badge-component badge badge-balanced">encendido</span>
            <span ng-if="component.device.devicestate.name == 'off'" class="badge-component badge badge-assertive">apagado</span>
        </div>
            <div class="item ">
                <div class="row">
                  <div class="col">
                    <span class="badge-letter">Consumo: <b>{{component.data_sum | number:1 }} W ({{ component.device_percent || 0 | number:1 }}% del total)</b></span>
                    <br><span class="badge-letter">Costo: <b>$ {{component.total_tarifa | number:1}}</b></span>
                    <br><span class="badge-letter">Co2: <b>{{ component.total_co2 | number:1 }} Kg</b></span>
                  </div>
                  <span class="badge badge-positive badge-statistics-last">Último: {{ component.last_data.value || 0 }} w</span>
                </div>
              </div>
            <div class="item text-center-statistics">
              <span>Último período</span>
            </div>
            <div class="item">
              <div class="row">
                <div class="col">
                  <span class="badge-letter elipsis"><b>Desde</b> {{ component.state_period_from | date:'dd/MM/yyyy HH:mm' }}<br><b>Hasta</b> {{ component.state_period_to | date:'dd/MM/yyyy HH:mm' }}.</span>
                </div>
                <div class="col align-right-text">
                  <b class="badge-letter">Consumo período</b><br>
                  <b class="badge-letter positive">{{ component.data_list_sum_states || 0 }} w</b>
                </div>
              </div>
            </div>
            <div class="item text-center-statistics">
              <div class="row">
                <div class="col">
                  <span>Encendidos: <b>{{component.device.state_counter_on}}</b></span>
                </div>
                <div class="col">
                </div>
                <div class="col align-right-text">
                  <span>Apagados: <b>{{component.device.state_counter_off}}</b></span>
                </div>
              </div>
            </div>
        </div>
      </div>
      <div ng-show="listado == false">
        <div class="card">
          <div class="item item-divider">
              <b>Porcentaje de consumo de componentes</b>
          </div>
          <div class="item">
            <canvas id="doughnut" height="150" class="chart chart-doughnut"
              chart-data="doughnutdata" chart-labels="doughnutlabels">
            </canvas>
          </div>
          <div class="item">
            <div class="row">
              <div class="col">

              </div>
              <div class="col">
                <div ng-repeat="value in doughnut.config.data.labels" style="margin-bottom:3px; text-align:center; font-size:0.65em; border-radius: 25px;background-color:{{doughnut.config.data.datasets[0].backgroundColor[$index]}};">
                  <span>{{ value }}</span>
                </div>
              </div>
              <div class="col">

              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="item item-divider">
              <b>Gafico comparativo de componentes</b>
          </div>
          <div class="item">
            <label class="item item-input item-select">
              <div class="input-label">
                Componente 1
              </div>
              <select ng-model="barOptions.componentLeft" >
                <option ng-repeat="component in components_server" value="{{component.id}}">{{component.label}}</option>
              </select>
            </label>
            <label class="item item-input item-select">
              <div class="input-label">
                Componente 2
              </div>
              <select ng-model="barOptions.componentRight" >
                <option ng-repeat="component in components_server" value="{{component.id}}">{{component.label}}</option>
              </select>
            </label>

            <label class="item item-input item-select">
              <div class="input-label">
                Precisión
              </div>
              <select ng-model="barOptions.precisionSelected" >
                <option ng-repeat="prec in barPrecision" value="{{prec.url}}" >{{prec.label}}</option>
              </select>
            </label>
            <div class="item">
              <a ng-click="createBarChart()" class="button icon-right ion-chevron-right button-calm">Ver gráfico</a>
            </div>
          </div>
          <div class="item">
            <canvas id="bar" class="chart chart-bar"
              chart-data="bardata" chart-labels="barlabels" chart-series="barseries">
            </canvas>
          </div>
          <div class="button-bar bar-calm">
            <a ng-disabled="previousbutton" ng-click="loadPage('last')" class="button button-small icon-left ion-chevron-left"></a>
            <select class="button button-small" ng-model="current_page" ng-change="loadPage(current_page)"
                    ng-options="page for page in number_pages" >
            </select>
            <a ng-disabled="nextbutton" ng-click="loadPage(1)" class="button button-small icon-right ion-chevron-right"></a>
          </div>
        </div>
      </div>
    </ion-content>
</ion-view>
